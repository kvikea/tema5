
<!DOCTYPE html>
<html>
    <head>
        <title>Visalle</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <style>
            body, html{margin:0; padding:0;}
            img {height: 100px;} 
            #liste{
                display: grid;
                grid-template-columns: 1fr 1fr;
                width: 50%; margin: auto;
                grid-gap: 3px;
            }
            .person{
                padding: 20px; background-color:lightgray;
            }

            .menu{text-align: center; margin-bottom: 20px;}
            .valgt{background-color: red;}
            h1{text-align: center;}
        </style>
    </head>
    <body>
        <header>
            <h1>Alle</h1>
            <nav class="menu">
                <button class="filter valgt" data-køn="alle">Alle</button>
                <button class="filter" data-køn="k">Kvinder</button>
                <button class="filter" data-køn="m">Mænd</button>
                <button class="filter" data-køn="andet">Andet</button>
            </nav>
        </header>
        <main>
            <section id="liste"></section>
        </main>
        <footer></footer>
        
        <script>
            let personer=[];
            let filter="alle";
            document.addEventListener("DOMContentLoaded", start);
            function start(){
                let dest=document.querySelector("#liste");
                
                async function getJson(){
                    let jsonData = await fetch("https://mandalskeawebspace.dk/claude_php/clean_up_spreadsheet.php?id=1OLlD_GRoz71piHvnW306omRAyHS7vtLOILQt-K0YF_c");
                    personer=await jsonData.json();
                    personer.sort((a, b) => {return a.navn.localeCompare(b.navn);});
                    localStorage.setItem("personer", JSON.stringify(personer));
                    visPersoner();
                }
                function visPersoner(){ 
                    dest.textContent="";
                    personer.forEach((person, i) =>{
                        if(filter=="alle" || filter==person.køn){
                            let nyPerson=document.createElement("article");
                            nyPerson.classList.add("person");
                            const template=`
                                <h2>${person.navn}</h2>
                                <img class="billede" src="${person.billede}" alt="Billede af ${person.navn}">
                                <p class="alder">Alder: ${person.alder}</p>`;
                            nyPerson.innerHTML=template;
                            nyPerson.addEventListener("click",()=>{
                                location.href="06-single2.html?id=" + i;
                            })
                            dest.appendChild(nyPerson);
                        }
                    })
                }
                document.querySelectorAll(".filter").forEach(elm =>{
                    elm.addEventListener("click", filtrering);
                })
                function filtrering(){
                    filter=this.getAttribute("data-køn");
                    visPersoner();
                    document.querySelector("h1").textContent=this.textContent;
                    document.querySelectorAll(".filter").forEach(elm =>{
                        elm.classList.remove("valgt");
                    })
                    this.classList.add("valgt");
                }
                hentPersoner=localStorage.getItem("personer");
                if (hentPersoner===null){
                    getJson();
                }else {
                    personer=JSON.parse(hentPersoner);
                    visPersoner();
                };
            }
        </script>
    </body>
</html>
